###############################################################################
# This is the default ansible deploy configuration of Cider-CI.
#
# It is linked from the playbook directory `group_vars/all.yml`, and thus
# has a very low priority when it comes to variables precedence and overriding
# with Ansible.
###############################################################################


###############################################################################
### general config ############################################################
###############################################################################

ci_clean_slate: false

ci_master_secret: "{{ lookup('password', inventory_dir + '/' + 'master_secret.txt chars=ascii_letters,digits,hexdigits length=40') }}"

server_base_url: http://{{ hostvars[groups['cider-ci_server'][0]].ansible_default_ipv4.address  }}

force_local_build: false

###############################################################################
### executor specific config ##################################################
###############################################################################

ci_exec_user: ci-exec-user
ci_working_dir: /tmp/ci_working-dir

### traits ####################################################################
# the default is not to install any of these traits
ci_trait_ansible: false
ci_trait_apache2: false
ci_trait_chruby: false
ci_trait_firefox_esr: false
ci_trait_leiningen: false
ci_trait_misc: false
ci_trait_mysql: false
ci_trait_nodejs: false
ci_trait_openjdk: false
ci_trait_phantomjs: false
ci_trait_postgresql: false
ci_trait_rabbitmq: false
ci_trait_rbenv: false
ci_trait_ruby_install: false
ci_trait_sqlite: false


###############################################################################
### Server specific config ####################################################
###############################################################################

ci_virtual_hosts:
- hostname: "{{ ci_internal_hostname }}"
  ip: "{{ ci_internal_hostname }}"
  logfile_infix: "{{ ci_internal_hostname }}"
- hostname: NULL
  ip: '*'
  ssl_certificate_file: /etc/ssl/certs/ssl-cert-snakeoil.pem
  ssl_certificate_key_file: /etc/ssl/private/ssl-cert-snakeoil.key


server_timezone: Etc/UTC
rails_timezone: UTC

  #- hostname: NULL
  #ssl_certificate_file: /etc/ssl/certs/ssl-cert-snakeoil.pem
  #ssl_certificate_key_file: /etc/ssl/private/ssl-cert-snakeoil.key


### Secrets ###################################################################

ci_management_admin_secret: '{ci_master_secret}'
ci_database_secret: "{{ [ci_master_secret, 'ci_database_secret', ci_master_secret ] | join(' ') | hash('sha256') }}"
ci_messaging_secret: "{{ [ci_master_secret, 'ci_messaging_secret', ci_master_secret ] | join(' ') | hash('sha256') }}"
ci_services_secret: "{{ [ci_master_secret, 'ci_services_secret', ci_master_secret ] | join(' ') | hash('sha256') }}"



###############################################################################
### server specific config, ###################################################
### meant to be overridden under special circumstances only ###################
###############################################################################

ci_internal_hostname: localhost

ci_postgres_port: 9432
ci_trait_rabbitmq_node_port: 5673
ci_rabbitmq_mangement_port: 15673

ci_server_dir: /cider-ci/server
ci_web_context: /cider-ci

ci_services:

  ui:
    name: user-interface
    type: rails
    path: /user-interface
    http_port: 8880
    context: /ui
    max_memory_fraction: 0.40
    cache_store_size_fraction: 0.05
    monit_match: java.*user-interface.*puma.*config\.ru

  api:
    name: api
    type: java
    path: /api
    http_port: 8885
    context: /api
    main: cider_ci.api.main
    monit_match: java.*cider_ci\.api\.main

  builder:
    name: builder
    type: java
    path: /builder
    http_port: 8884
    context: /builder
    main: cider_ci.builder.main
    monit_match: java.*cider_ci\.builder\.main

  dispatcher:
    name: dispatcher
    type: java
    path: /dispatcher
    http_port: 8882
    context: /dispatcher
    main: cider_ci.dispatcher.main
    monit_match: java.*cider_ci\.dispatcher\.main

  notifier:
    name: notifier
    type: java
    path: /notifier
    http_port: 8887
    context: /notifier
    main: cider_ci.notifier.main
    monit_match: java.*cider_ci\.notifier\.main

  repository:
    name: repository
    type: java
    path: /repository
    http_port: 8881
    context: /repositories
    main: cider_ci.repository.main
    monit_match: java.*cider_ci\.repository\.main

  storage:
    name: storage
    type: java
    path: /storage
    context: /storage
    http_port: 8886
    main: cider_ci.storage.main
    monit_match: java.*cider_ci\.storage\.main

